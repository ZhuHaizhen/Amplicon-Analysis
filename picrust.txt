usearch7.0 -fastq_filter cave.out.fastq -fastq_maxee 0.5 -fastaout cave.out.fasta
usearch7.0 -fastq_filter cave.in.fastq -fastq_maxee 0.5 -fastaout cave.in.fasta

usearch7.0 -derep_fulllength cave.out.fasta -output cave.out_derep.fa
usearch7.0 -derep_fulllength cave.in.fasta -output cave.in_derep.fa

usearch7.0 -uchime_ref cave.out_derep.fa -db /data/share/scripts/gold.fa -strand plus -nonchimeras cave.out_unchime.fa
usearch7.0 -uchime_ref cave.in_derep.fa -db /data/share/scripts/gold.fa -strand plus -nonchimeras cave.in_unchime.fa

perl /data/share/scripts/multiple-line-to-single-line.pl cave.in_unchime.fa cave.in_otus.fa
perl /data/share/scripts/multiple-line-to-single-line.pl cave.out_unchime.fa cave.out_otus.fa

perl -i.bak -pe 'if ($.%2==1){$count++;s/(^>).*/$1in_$count/}' cave.in_otus.fa
perl -i.bak -pe 'if ($.%2==1){$count++;s/(^>).*/$1out_$count/}' cave.out_otus.fa

cat cave.in_otus.fa cave.out_otus.fa > cave.fa

echo "pick_otus:enable_rev_strand_match True" >> $PWD/otu_picking_params_97.txt

echo "pick_otus:similarity0.97" >> $PWD/otu_picking_params_97.txt

pick_closed_reference_otus.py -i cave.fa -o otu_taxonomy -p otu_picking_params_97.txt -t /data/huangye/16s/PICRUSt/gg_13_5_otus/taxonomy/97_otu_taxonomy.txt -r /data/huangye/16s/PICRUSt/gg_13_5_otus/rep_set/97_otus.fasta -a -O 4

biom summarize-table -i otu_taxonomy/otu_table.biom -o otu_table.info

biom convert -i otu_taxonomy/otu_table.biom -o otu_table.txt --to-tsv

normalize_by_copy_number.py -i otu_taxonomy/otu_table.biom -o normalized.biom

predict_metagenomes.py -i normalized.biom -o Predict_Metagenome.biom

biom convert -i Predict_Metagenome.biom -o Predict_Metagenome.txt --to-tsv

categorize_by_function.py -f -i Predict_Metagenome.biom -c KEGG_Pathways -l 3 -o Pathway_L3.txt

# Biosynthesis of vancomycin group antibiotics(ko01055)
metagenome_contributions.py -i normalized.biom -l K16421,K16422,K16423,K16424,K16425,K16426,K16427,K16428,K16429,K16430,K16431,K16432,K16433,K16434,K01710,K16535,K16436,K16437,K16438,K16439,K18836,K16440,K16442,K16443,K16444,K16445,K16446,K16447,K16448 -t ko -o ko01055_contributions.tab
# Valine, leucine and isoleucine biosynthesis(ko00290)
metagenome_contributions.py -i normalized.biom -l K01754,K17989,K09011,K01702,K01703,K01704,K00052,K01652,K01653,K11258,K00053,K01687,K00826,K00263,K00835,K14260,K01649,K21359,K21360 -t ko -o ko00290_contributions.tab
# D-Glutamine and D-glutamate metabolism(ko00471)
metagenome_contributions.py -i normalized.biom -l K01776,K01925,K22210,K01425,K05597,K00261,K01924 -t ko -o ko00290_contributions.tab

humann2_split_table --input Predict_Metagenome.biom --output humann_input

humann2 --input humann_input/in.biom --output humann_output --pathways-database /zhuhz/results/zhuhz/software/humann-0.99/data/keggc
humann2 --input humann_input/out.biom --output humann_output --pathways-database /zhuhz/results/zhuhz/software/humann-0.99/data/keggc

humann2_join_tables --input humann_output --output humann2_pathcoverage.tsv --file_name pathcoverage

humann2_join_tables --input humann_output --output humann2_pathabundance.tsv --file_name pathabundance



cat *A*.fastq > air.fastq
cat *R*.fastq > rock.fastq
cat *S*.fastq > soil.fastq
cat *W*.fastq > water.fastq

vsearch -fastq_filter air.fastq -fastq_maxee 0.5 -fastaout air.fasta
vsearch -fastq_filter rock.fastq -fastq_maxee 0.5 -fastaout rock.fasta
vsearch -fastq_filter soil.fastq -fastq_maxee 0.5 -fastaout soil.fasta
vsearch -fastq_filter water.fastq -fastq_maxee 0.5 -fastaout water.fasta

vsearch -derep_fulllength air.fasta -output air_derep.fa
vsearch -derep_fulllength rock.fasta -output rock_derep.fa
vsearch -derep_fulllength soil.fasta -output soil_derep.fa
vsearch -derep_fulllength water.fasta -output water_derep.fa

vsearch -uchime_ref air_derep.fa -db /data/share/scripts/gold.fa -strand plus -nonchimeras air_unchime.fa
vsearch -uchime_ref rock_derep.fa -db /data/share/scripts/gold.fa -strand plus -nonchimeras rock_unchime.fa
vsearch -uchime_ref soil_derep.fa -db /data/share/scripts/gold.fa -strand plus -nonchimeras soil_unchime.fa
vsearch -uchime_ref water_derep.fa -db /data/share/scripts/gold.fa -strand plus -nonchimeras water_unchime.fa

perl /data/share/scripts/multiple-line-to-single-line.pl air_unchime.fa air_otus.fa
perl /data/share/scripts/multiple-line-to-single-line.pl rock_unchime.fa rock_otus.fa
perl /data/share/scripts/multiple-line-to-single-line.pl soil_unchime.fa soil_otus.fa
perl /data/share/scripts/multiple-line-to-single-line.pl water_unchime.fa water_otus.fa

perl -i.bak -pe 'if ($.%2==1){$count++;s/(^>).*/$1air_$count/}' air_otus.fa
perl -i.bak -pe 'if ($.%2==1){$count++;s/(^>).*/$1rock_$count/}' rock_otus.fa
perl -i.bak -pe 'if ($.%2==1){$count++;s/(^>).*/$1soil_$count/}' soil_otus.fa
perl -i.bak -pe 'if ($.%2==1){$count++;s/(^>).*/$1water_$count/}' water_otus.fa

cat air_otus.fa rock_otus.fa soil_otus.fa water_otus.fa > cave.in.fa

pick_closed_reference_otus.py -i cave.in.fa -o otu_taxonomy -p otu_picking_params_97.txt -t /data/huangye/16s/PICRUSt/gg_13_5_otus/taxonomy/97_otu_taxonomy.txt -r /data/huangye/16s/PICRUSt/gg_13_5_otus/rep_set/97_otus.fasta -a -O 4

biom summarize-table -i otu_taxonomy/otu_table.biom -o otu_table.info

normalize_by_copy_number.py -i otu_taxonomy/otu_table.biom -o normalized.in.biom

predict_metagenomes.py -i normalized.in.biom -o Predict_Metagenome.in.biom

biom convert -i Predict_Metagenome.in.biom -o Predict_Metagenome.in.txt --to-tsv

categorize_by_function.py -f -i Predict_Metagenome.in.biom -c KEGG_Pathways -l 3 -o Pathway_L3.in.txt


humann2_split_table --input Predict_Metagenome.in.biom --output humann_input.in

humann2 --input humann_input.in/air.biom --output humann_output.in --pathways-database /zhuhz/results/zhuhz/software/humann-0.99/data/keggc
humann2 --input humann_input.in/rock.biom --output humann_output.in --pathways-database /zhuhz/results/zhuhz/software/humann-0.99/data/keggc
humann2 --input humann_input.in/soil.biom --output humann_output.in --pathways-database /zhuhz/results/zhuhz/software/humann-0.99/data/keggc
humann2 --input humann_input.in/water.biom --output humann_output.in --pathways-database /zhuhz/results/zhuhz/software/humann-0.99/data/keggc

humann2_join_tables --input humann_output.in --output humann2_pathcoverage.in.tsv --file_name pathcoverage

humann2_join_tables --input humann_output.in --output humann2_pathabundance.in.tsv --file_name pathabundance

